<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dart-Zähler</title>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #2980b9;
            --accent-color: #e74c3c;
            --background-color: #ecf0f1;
            --text-color: #333;
            --border-radius: 8px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 960px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            color: var(--primary-color);
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .setup-container {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .game-settings {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 15px;
            margin-bottom: 20px;
        }

        .setting-group {
            flex: 1;
            min-width: 200px;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: var(--primary-color);
        }

        select, input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-size: 1rem;
        }

        button {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        button:hover {
            background-color: #3498db;
        }

        button.accent {
            background-color: var(--accent-color);
        }

        button.accent:hover {
            background-color: #c0392b;
        }

        .btn-group {
            display: flex;
            gap: 10px;
        }

        .game-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .scoreboard, .input-area {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            flex: 1;
            min-width: 300px;
        }

        .scoreboard {
            overflow-x: auto;
        }

        .scoreboard-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .player-cards {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .player-card {
            flex: 1;
            min-width: 200px;
            border: 2px solid var(--primary-color);
            border-radius: var(--border-radius);
            padding: 15px;
            text-align: center;
            position: relative;
        }

        .player-card.active {
            border-color: var(--accent-color);
            box-shadow: 0 0 10px rgba(231, 76, 60, 0.5);
        }

        .player-name {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary-color);
        }

        .player-score {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .player-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        .dart-input {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
        }

        .input-group button {
            flex-shrink: 0;
        }

        .history {
            margin-top: 15px;
        }

        .history-container {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 10px;
            background-color: #f9f9f9;
        }

        .history-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9rem;
        }

        .hidden {
            display: none;
        }

        .player-turn-indicator {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--accent-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .leg-counter {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            justify-content: center;
        }

        .leg {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #ddd;
        }

        .leg.won {
            background-color: var(--accent-color);
        }

        .set-counter {
            display: flex;
            gap: 5px;
            margin-top: 5px;
            justify-content: center;
        }

        .set {
            width: 15px;
            height: 15px;
            border-radius: 3px;
            background-color: #ddd;
        }

        .set.won {
            background-color: var(--secondary-color);
        }

        .restart-btn {
            margin-top: 20px;
        }

        .average-score {
            font-size: 1.1rem;
            margin-top: 5px;
            color: var(--secondary-color);
        }

        .statistics-container {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .input-container {
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
        }

        .input-container .input-group {
            margin-bottom: 10px;
        }

        h3 {
            font-size: 1.1rem;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .player-statistic {
            margin-bottom: 12px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .player-statistic:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

        .statistic-name {
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .statistic-details {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            gap: 10px;
            font-size: 0.9rem;
        }

        .statistic-item {
            flex: 1;
            min-width: 100px;
        }

        .statistic-label {
            color: #666;
            font-size: 0.8rem;
            display: block;
        }

        .statistic-value {
            font-weight: bold;
            font-size: 1rem;
        }

        .turn-timer {
            background-color: #eee;
            border-radius: 10px;
            padding: 3px 8px;
            color: #333;
        }

        .player-card.winner {
            animation: winner-animation 2s ease;
        }

        @keyframes winner-animation {
            0% {
                transform: scale(1);
            }
            25% {
                transform: scale(1.1);
                background-color: #f8d568;
            }
            50% {
                transform: scale(1);
                background-color: white;
            }
            75% {
                transform: scale(1.05);
                background-color: #f8d568;
            }
            100% {
                transform: scale(1);
                background-color: white;
            }
        }

        .confetti {
            position: fixed;
            width: 10px;
            height: 10px;
            opacity: 0;
            animation: confetti-fall 4s ease-in-out forwards;
            z-index: 1000;
        }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(calc(100vh + 100px)) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .game-settings {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Dart-Zähler</h1>
        <p>Behalte den Überblick über dein Dart-Spiel</p>
    </header>

    <div class="setup-container" id="setup">
        <h2>Spiel-Einstellungen</h2>
        <div class="game-settings">
            <div class="setting-group">
                <label for="game-type">Spieltyp:</label>
                <select id="game-type">
                    <option value="501">501</option>
                    <option value="301">301</option>
                    <option value="701">701</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="num-players">Anzahl Spieler:</label>
                <select id="num-players">
                    <option value="1">1 Spieler</option>
                    <option value="2" selected>2 Spieler</option>
                    <option value="3">3 Spieler</option>
                    <option value="4">4 Spieler</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="num-sets">Sets:</label>
                <select id="num-sets">
                    <option value="1">Best of 1</option>
                    <option value="3" selected>Best of 3</option>
                    <option value="5">Best of 5</option>
                    <option value="7">Best of 7</option>
                </select>
            </div>

            <div class="setting-group">
                <label for="num-legs">Legs pro Set:</label>
                <select id="num-legs">
                    <option value="1">Best of 1</option>
                    <option value="3" selected>Best of 3</option>
                    <option value="5">Best of 5</option>
                    <option value="7">Best of 7</option>
                </select>
            </div>
        </div>

        <div id="player-names-container">
            <!-- Player name inputs will be generated here -->
        </div>

        <div class="btn-group">
            <button id="start-game">Spiel starten</button>
            <button id="reset-settings" class="accent">Zurücksetzen</button>
        </div>
    </div>

    <div class="game-container hidden" id="game">
        <div class="scoreboard">
            <div class="scoreboard-header">
                <h2>Punktestand</h2>
                <button id="undo-throw" class="accent">Wurf zurücknehmen</button>
            </div>

            <div class="player-cards" id="player-cards">
                <!-- Player cards will be generated here -->
            </div>
        </div>

        <div class="input-area">
            <div class="dart-input">
                <h3>Statistiken</h3>
                <div class="statistics-container">
                    <div id="player-statistics">
                        <!-- Player statistics will be generated here -->
                    </div>
                </div>

                <h3>Punkteeingabe</h3>
                <div class="input-container">
                    <div class="input-group">
                        <input type="number" id="current-input"
                               placeholder="Gesamtpunkte für 3 Würfe" min="0" max="180">
                        <button id="clear-input" class="accent">Löschen</button>
                    </div>

                    <button id="submit-score">Punkte eingeben</button>
                </div>
            </div>

            <div class="history">
                <h3>Verlauf</h3>
                <div class="history-container">
                    <div id="history-container">
                        <!-- History entries will be added here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button id="restart-game" class="restart-btn hidden">Neues Spiel starten</button>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        // DOM Elements
        const setupContainer = document.getElementById('setup');
        const gameContainer = document.getElementById('game');
        const playerNamesContainer = document.getElementById('player-names-container');
        const playerCardsContainer = document.getElementById('player-cards');
        const startGameButton = document.getElementById('start-game');
        const resetSettingsButton = document.getElementById('reset-settings');
        const restartGameButton = document.getElementById('restart-game');
        const numPlayersSelect = document.getElementById('num-players');
        const gameTypeSelect = document.getElementById('game-type');
        const numSetsSelect = document.getElementById('num-sets');
        const numLegsSelect = document.getElementById('num-legs');
        const currentInputField = document.getElementById('current-input');
        const clearInputButton = document.getElementById('clear-input');
        const submitScoreButton = document.getElementById('submit-score');
        const undoThrowButton = document.getElementById('undo-throw');
        const historyContainer = document.getElementById('history-container');

        // Game state
        let gameState = {
            players: [],
            currentPlayerIndex: 0,
            dartsThrown: [],
            gameType: 501,
            numSets: 3,
            numLegs: 3,
            currentLeg: 1,
            currentSet: 1,
            history: [],
            turnStartTime: null,
            gameStartTime: null,
            timerInterval: null
        };

        // Initialize player name inputs
        function initPlayerNameInputs() {
            const numPlayers = parseInt(numPlayersSelect.value);
            playerNamesContainer.innerHTML = '';

            for (let i = 0; i < numPlayers; i++) {
                const playerGroup = document.createElement('div');
                playerGroup.className = 'setting-group';

                const label = document.createElement('label');
                label.setAttribute('for', `player-${i + 1}-name`);
                label.textContent = `Spieler ${i + 1} Name:`;

                const input = document.createElement('input');
                input.type = 'text';
                input.id = `player-${i + 1}-name`;
                input.placeholder = `Spieler ${i + 1}`;
                input.value = `Spieler ${i + 1}`;

                playerGroup.appendChild(label);
                playerGroup.appendChild(input);
                playerNamesContainer.appendChild(playerGroup);
            }
        }

        // Initialize game
        function initGame() {
            const numPlayers = parseInt(numPlayersSelect.value);
            const gameType = parseInt(gameTypeSelect.value);
            const numSets = parseInt(numSetsSelect.value);
            const numLegs = parseInt(numLegsSelect.value);

            gameState = {
                players: [],
                currentPlayerIndex: 0,
                dartsThrown: [],
                gameType: gameType,
                numSets: numSets,
                numLegs: numLegs,
                currentLeg: 1,
                currentSet: 1,
                history: [],
                turnStartTime: new Date(),
                gameStartTime: new Date(),
                timerInterval: null
            };

            // Initialize players
            for (let i = 0; i < numPlayers; i++) {
                const nameInput = document.getElementById(`player-${i + 1}-name`);
                const playerName = nameInput.value.trim() || `Spieler ${i + 1}`;

                gameState.players.push({
                    name: playerName,
                    score: gameType,
                    dartsThrown: 0,
                    legsWon: 0,
                    setsWon: 0,
                    scores: [],
                    averageScore: 0,
                    highestScore: 0,
                    turnTime: 0,
                    turnCount: 0,
                    averageTurnTime: 0
                });
            }

            renderPlayerCards();
            renderHistory();
            renderPlayerStatistics();

            // Start the turn timer
            startTurnTimer();

            // Show game container, hide setup
            setupContainer.classList.add('hidden');
            gameContainer.classList.remove('hidden');
            restartGameButton.classList.remove('hidden');
        }

        // Render player cards
        function renderPlayerCards() {
            playerCardsContainer.innerHTML = '';

            gameState.players.forEach((player, index) => {
                const playerCard = document.createElement('div');
                playerCard.className = `player-card ${index === gameState.currentPlayerIndex ? 'active' : ''}`;

                // Turn indicator for active player
                if (index === gameState.currentPlayerIndex) {
                    const turnIndicator = document.createElement('div');
                    turnIndicator.className = 'player-turn-indicator';
                    turnIndicator.textContent = 'Aktuell am Zug';
                    playerCard.appendChild(turnIndicator);
                }

                const playerName = document.createElement('div');
                playerName.className = 'player-name';
                playerName.textContent = player.name;

                const playerScore = document.createElement('div');
                playerScore.className = 'player-score';
                playerScore.textContent = player.score;

                const averageScore = document.createElement('div');
                averageScore.className = 'average-score';
                averageScore.textContent = `Ø ${player.averageScore.toFixed(1)}`;

                // Leg counter
                const legCounter = document.createElement('div');
                legCounter.className = 'leg-counter';

                const legsNeeded = Math.ceil(gameState.numLegs / 2);
                for (let i = 0; i < legsNeeded; i++) {
                    const leg = document.createElement('div');
                    leg.className = `leg ${i < player.legsWon ? 'won' : ''}`;
                    legCounter.appendChild(leg);
                }

                // Set counter
                const setCounter = document.createElement('div');
                setCounter.className = 'set-counter';

                const setsNeeded = Math.ceil(gameState.numSets / 2);
                for (let i = 0; i < setsNeeded; i++) {
                    const set = document.createElement('div');
                    set.className = `set ${i < player.setsWon ? 'won' : ''}`;
                    setCounter.appendChild(set);
                }

                const playerStats = document.createElement('div');
                playerStats.className = 'player-stats';

                const dartsThrown = document.createElement('span');
                dartsThrown.textContent = `Darts: ${player.dartsThrown}`;

                const aufnahmenInfo = document.createElement('span');
                aufnahmenInfo.textContent = `Aufnahmen: ${Math.floor(player.dartsThrown / 3)}`;

                playerStats.appendChild(dartsThrown);
                playerStats.appendChild(aufnahmenInfo);

                playerCard.appendChild(playerName);
                playerCard.appendChild(playerScore);
                playerCard.appendChild(averageScore);
                playerCard.appendChild(legCounter);
                playerCard.appendChild(setCounter);
                playerCard.appendChild(playerStats);

                playerCardsContainer.appendChild(playerCard);
            });
        }

        // Update player's average score
        function updateAverageScore(player) {
            if (player.scores.length === 0) return;

            const totalScore = player.scores.reduce((sum, score) => sum + score, 0);
            const numDarts = player.dartsThrown;
            player.averageScore = (totalScore / numDarts) * 3; // Multiply by 3 for the standard 3-dart average
        }

        // Submit score
        function submitScore() {
            let scoreValue = parseInt(currentInputField.value);

            // If no input, treat as 0
            if (isNaN(scoreValue)) {
                scoreValue = 0;
                currentInputField.value = "0";
            }

            // Validate score
            if (scoreValue < 0 || scoreValue > 180) {
                alert("Bitte gib eine gültige Punktzahl zwischen 0 und 180 ein.");
                return;
            }

            const currentPlayer = gameState.players[gameState.currentPlayerIndex];

            // Check if the score would bust
            if (currentPlayer.score - scoreValue < 0) {
                // Show warning
                alert(`Überworfen! ${currentPlayer.name} kann nicht mehr als ${currentPlayer.score} Punkte abziehen.`);
                return; // Don't record the bust until valid score is entered
            }

            // Update highest score if applicable
            if (scoreValue > currentPlayer.highestScore) {
                currentPlayer.highestScore = scoreValue;
            }

            // Check for checkout
            if (currentPlayer.score - scoreValue === 0) {
                // Player wins the leg
                currentPlayer.score -= scoreValue;
                currentPlayer.scores.push(scoreValue);
                currentPlayer.dartsThrown += 3; // Always count as 3 darts for 3-dart sum
                gameState.dartsThrown.push(scoreValue);

                // Update average score
                updateAverageScore(currentPlayer);

                addHistoryEntry(`${currentPlayer.name} - Checkout mit ${scoreValue} Punkten!`);

                // Player won leg
                currentPlayer.legsWon += 1;

                // Animate win
                animateWin();

                // Check if player won set
                if (currentPlayer.legsWon >= Math.ceil(gameState.numLegs / 2)) {
                    currentPlayer.setsWon += 1;
                    addHistoryEntry(`${currentPlayer.name} gewinnt Set ${gameState.currentSet}!`);

                    // Check if player won match
                    if (currentPlayer.setsWon >= Math.ceil(gameState.numSets / 2)) {
                        addHistoryEntry(`${currentPlayer.name} gewinnt das Spiel!`);
                        renderPlayerCards();
                        renderHistory();
                        renderPlayerStatistics();
                        return;
                    }

                    // Reset legs for next set
                    gameState.players.forEach(p => p.legsWon = 0);
                    gameState.currentSet += 1;
                }

                // Reset scores for next leg
                gameState.players.forEach(p => p.score = gameState.gameType);
                gameState.currentLeg += 1;

                renderPlayerCards();
                renderHistory();
                renderPlayerStatistics();
                clearInput();
                return;
            }

            // Regular throw
            currentPlayer.score -= scoreValue;
            currentPlayer.scores.push(scoreValue);
            currentPlayer.dartsThrown += 3; // Always count as 3 darts for 3-dart sum
            gameState.dartsThrown.push(scoreValue);

            // Update average score
            updateAverageScore(currentPlayer);

            addHistoryEntry(`${currentPlayer.name} - ${scoreValue} Punkte`);

            // Move to next player (always after 3 darts in this mode)
            nextPlayer();

            clearInput();
            renderPlayerCards();
            renderHistory();
            renderPlayerStatistics();
        }

        // Move to next player
        function nextPlayer() {
            // Record turn time for current player
            const currentTime = new Date();
            const currentPlayer = gameState.players[gameState.currentPlayerIndex];
            const turnDuration = (currentTime - gameState.turnStartTime) / 1000; // in seconds

            currentPlayer.turnTime += turnDuration;
            currentPlayer.turnCount += 1;
            currentPlayer.averageTurnTime = currentPlayer.turnTime / currentPlayer.turnCount;

            // Move to next player
            gameState.currentPlayerIndex = (gameState.currentPlayerIndex + 1) % gameState.players.length;

            // Reset turn timer for next player
            gameState.turnStartTime = new Date();

            // Update statistics
            renderPlayerStatistics();
        }

        // Clear input
        function clearInput() {
            currentInputField.value = '';
        }

        // Add history entry
        function addHistoryEntry(text) {
            gameState.history.push({
                text: text,
                timestamp: new Date()
            });
        }

        // Render history
        function renderHistory() {
            historyContainer.innerHTML = '';

            // Show most recent entries first
            for (let i = gameState.history.length - 1; i >= 0; i--) {
                const entry = gameState.history[i];
                const historyEntry = document.createElement('div');
                historyEntry.className = 'history-entry';

                const time = entry.timestamp.toLocaleTimeString([], {
                    hour: '2-digit',
                    minute: '2-digit'
                });
                historyEntry.textContent = `${time} - ${entry.text}`;

                historyContainer.appendChild(historyEntry);

                // Limit history to last 20 entries
                if (historyContainer.children.length >= 20) {
                    break;
                }
            }
        }

        // Animation for win
        function animateWin() {
            // Add winner class to current player card
            const playerCards = document.querySelectorAll('.player-card');
            playerCards[gameState.currentPlayerIndex].classList.add('winner');

            // Remove the class after animation completes
            setTimeout(() => {
                playerCards[gameState.currentPlayerIndex].classList.remove('winner');
            }, 2000);

            // Create confetti effect
            createConfetti();
        }

        // Create confetti animation
        function createConfetti() {
            const container = document.body;
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f1c40f', '#9b59b6', '#e67e22'];
            const confettiCount = 100;

            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = `${Math.random() * 10 + 5}px`;
                confetti.style.height = `${Math.random() * 10 + 5}px`;
                confetti.style.animationDuration = `${Math.random() * 3 + 2}s`;
                confetti.style.animationDelay = `${Math.random() * 1.5}s`;

                container.appendChild(confetti);

                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 6000);
            }
        }

        // Undo last throw
        function undoLastThrow() {
            if (gameState.dartsThrown.length === 0) {
                return; // Nothing to undo
            }

            // Remove last entry from history
            if (gameState.history.length > 0) {
                gameState.history.pop();
            }

            // Get last throw
            const lastThrow = gameState.dartsThrown.pop();

            // Determine whose throw to undo
            let playerIndex = gameState.currentPlayerIndex;

            // We're at the start of a player's turn, so the last throw was from previous player
            playerIndex = (playerIndex - 1 + gameState.players.length) % gameState.players.length;
            gameState.currentPlayerIndex = playerIndex;

            const player = gameState.players[playerIndex];

            // Restore score if it wasn't a bust
            if (lastThrow !== 0) {
                // Ensure score doesn't exceed game type (starting score)
                player.score = Math.min(player.score + lastThrow, gameState.gameType);
                player.dartsThrown -= 3;

                // Remove the last score from the player's scores array
                if (player.scores.length > 0) {
                    player.scores.pop();
                }

                // Update average
                updateAverageScore(player);

                // Revert turn time tracking
                if (player.turnCount > 0) {
                    player.turnCount -= 1;
                    // This is approximate since we don't store individual turn times
                    if (player.turnCount > 0) {
                        player.averageTurnTime = player.turnTime / player.turnCount;
                    } else {
                        player.turnTime = 0;
                        player.averageTurnTime = 0;
                    }
                }
            }

            // Reset the turn timer for the current player
            gameState.turnStartTime = new Date();

            renderPlayerCards();
            renderHistory();
            renderPlayerStatistics();
        }

        // Reset all settings
        function resetSettings() {
            numPlayersSelect.value = '2';
            gameTypeSelect.value = '501';
            numSetsSelect.value = '3';
            numLegsSelect.value = '3';

            initPlayerNameInputs();
        }

        // Restart game
        function restartGame() {
            // Clear timer interval if it exists
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }

            setupContainer.classList.remove('hidden');
            gameContainer.classList.add('hidden');
            restartGameButton.classList.add('hidden');

            initPlayerNameInputs();
        }

        // Start turn timer
        function startTurnTimer() {
            // Set initial turn time
            gameState.turnStartTime = new Date();

            // Update timer display every second
            const timerInterval = setInterval(() => {
                renderPlayerStatistics();
            }, 1000);

            // Store interval ID in game state to clear it later if needed
            gameState.timerInterval = timerInterval;
        }

        // Render player statistics
        function renderPlayerStatistics() {
            const statisticsContainer = document.getElementById('player-statistics');
            statisticsContainer.innerHTML = '';

            // Calculate game duration
            const gameTimeInSeconds = Math.floor((new Date() - gameState.gameStartTime) / 1000);
            const gameHours = Math.floor(gameTimeInSeconds / 3600);
            const gameMinutes = Math.floor((gameTimeInSeconds % 3600) / 60);
            const gameSeconds = gameTimeInSeconds % 60;
            const gameTimeFormatted =
                `${gameHours > 0 ? gameHours + 'h ' : ''}${gameMinutes}m ${gameSeconds.toString().padStart(2, '0')}s`;

            // Game duration statistic
            const gameDurationDiv = document.createElement('div');
            gameDurationDiv.className = 'player-statistic';

            const gameDurationTitle = document.createElement('div');
            gameDurationTitle.className = 'statistic-name';
            gameDurationTitle.textContent = 'Spieldauer';

            const gameDurationValue = document.createElement('div');
            gameDurationValue.className = 'statistic-value';
            gameDurationValue.textContent = gameTimeFormatted;

            gameDurationDiv.appendChild(gameDurationTitle);
            gameDurationDiv.appendChild(gameDurationValue);
            statisticsContainer.appendChild(gameDurationDiv);

            // Player statistics
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player-statistic';

                const playerName = document.createElement('div');
                playerName.className = 'statistic-name';

                // Add turn indicator for current player
                if (index === gameState.currentPlayerIndex) {
                    const turnTime = Math.floor((new Date() - gameState.turnStartTime) / 1000);
                    const minutes = Math.floor(turnTime / 60);
                    const seconds = turnTime % 60;
                    const timeFormatted = `${minutes > 0 ? minutes + 'm ' : ''}${seconds.toString().padStart(2, '0')}s`;

                    playerName.innerHTML = `${player.name} <span class="turn-timer">${timeFormatted}</span>`;
                } else {
                    playerName.textContent = player.name;
                }

                // Statistic details container
                const detailsDiv = document.createElement('div');
                detailsDiv.className = 'statistic-details';

                // Average score
                const avgScoreDiv = document.createElement('div');
                avgScoreDiv.className = 'statistic-item';

                const avgScoreLabel = document.createElement('span');
                avgScoreLabel.className = 'statistic-label';
                avgScoreLabel.textContent = 'Durchschnitt';

                const avgScoreValue = document.createElement('div');
                avgScoreValue.className = 'statistic-value';
                avgScoreValue.textContent = player.averageScore.toFixed(1);

                avgScoreDiv.appendChild(avgScoreLabel);
                avgScoreDiv.appendChild(avgScoreValue);

                // Highest score
                const highScoreDiv = document.createElement('div');
                highScoreDiv.className = 'statistic-item';

                const highScoreLabel = document.createElement('span');
                highScoreLabel.className = 'statistic-label';
                highScoreLabel.textContent = 'Höchste Aufnahme';

                const highScoreValue = document.createElement('div');
                highScoreValue.className = 'statistic-value';
                highScoreValue.textContent = player.highestScore || "0";

                highScoreDiv.appendChild(highScoreLabel);
                highScoreDiv.appendChild(highScoreValue);

                // Average turn time
                const avgTimeDiv = document.createElement('div');
                avgTimeDiv.className = 'statistic-item';

                const avgTimeLabel = document.createElement('span');
                avgTimeLabel.className = 'statistic-label';
                avgTimeLabel.textContent = 'Ø Zeit pro Zug';

                const avgTimeValue = document.createElement('div');
                avgTimeValue.className = 'statistic-value';

                if (player.turnCount > 0) {
                    const avgSeconds = Math.floor(player.averageTurnTime);
                    avgTimeValue.textContent = `${avgSeconds}s`;
                } else {
                    avgTimeValue.textContent = '-';
                }

                avgTimeDiv.appendChild(avgTimeLabel);
                avgTimeDiv.appendChild(avgTimeValue);

                // Total turn time
                const totalTimeDiv = document.createElement('div');
                totalTimeDiv.className = 'statistic-item';

                const totalTimeLabel = document.createElement('span');
                totalTimeLabel.className = 'statistic-label';
                totalTimeLabel.textContent = 'Gesamtzeit';

                const totalTimeValue = document.createElement('div');
                totalTimeValue.className = 'statistic-value';

                const totalSeconds = Math.floor(player.turnTime);
                const minutes = Math.floor(totalSeconds / 60);
                const seconds = totalSeconds % 60;
                totalTimeValue.textContent = `${minutes > 0 ? minutes + 'm ' : ''}${seconds.toString().padStart(2, '0')}s`;

                totalTimeDiv.appendChild(totalTimeLabel);
                totalTimeDiv.appendChild(totalTimeValue);

                // Add all statistics to details container
                detailsDiv.appendChild(avgScoreDiv);
                detailsDiv.appendChild(highScoreDiv);
                detailsDiv.appendChild(avgTimeDiv);
                detailsDiv.appendChild(totalTimeDiv);

                // Add to player div
                playerDiv.appendChild(playerName);
                playerDiv.appendChild(detailsDiv);

                // Add to statistics container
                statisticsContainer.appendChild(playerDiv);
            });
        }

        // Event listeners
        numPlayersSelect.addEventListener('change', initPlayerNameInputs);
        startGameButton.addEventListener('click', initGame);
        resetSettingsButton.addEventListener('click', resetSettings);
        restartGameButton.addEventListener('click', restartGame);

        clearInputButton.addEventListener('click', clearInput);
        submitScoreButton.addEventListener('click', submitScore);
        undoThrowButton.addEventListener('click', undoLastThrow);

        // Add Enter key event listener for score input
        currentInputField.addEventListener('keypress', function (event) {
            if (event.key === 'Enter') {
                event.preventDefault(); // Prevent form submission
                submitScore();
            }
        });

        // Initialize on page load
        initPlayerNameInputs();
    });
</script>
</body>
</html>